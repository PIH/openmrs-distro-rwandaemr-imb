<htmlform> <!--
	   Oncology Clinical Intake Form
	   ClinicalIntake_ONCOLOGY_V1.3NT2012July4 copy
		Author:
		Builder: Jberchmas
		started on Sept 22, 2012
	-->

    <macros>
        @Screening_through@ = 7e4e6554-d6c5-4ca3-b371-49806a754992
        @HPV_DNA_test@ = f7c2d59d-2043-42ce-b04d-08564d54b0c7
        @OTHER_NON-CODED@ = 3cee7fb4-26fe-102b-80cb-0017a47871b2
        @Test_Result@ = bfb3eb1e-db98-4846-9915-0168511c6298
        @HPV_positive@ = 1b4a5f67-6106-4a4d-a389-2f430be543e4
        @HPV_negative@ = 64c23192-54e4-4750-9155-2ed0b736a0db
        @HPV_positive_Type@ = 1b4a5f67-6106-4a4d-a389-2f430be543e4
        @HPV_16@ = 059fddd3-711f-47ab-818f-087984aeecc3
        @HPV_18@ = b672c3ff-96c9-41cd-9ae6-aa0811ce347f
        @Other_HR_HPV@ = 6c3428c6-f406-4ef9-b2dd-4fe5a79f3432
        @LABORATORY_TESTS_OTHER@ = 3cd9b714-26fe-102b-80cb-0017a47871b2
        @OTHER_LAB_TEST_RESULT@ = 3ce1ca8a-26fe-102b-80cb-0017a47871b2
        @Specimen_Code@ = 16cd65e3-45af-4291-88fd-fe4d91847e4f
        @Failed_results@ = 3b989534-ca6b-4bef-b99c-cd8397b1cdbe
        @RETURN_VISIT_DATE@ = 3ce94df0-26fe-102b-80cb-0017a47871b2
        @HPV_31@ = 198b9d57-3485-44d9-a217-854f54b0fa71
        @HPV_33@ = 8447c8d5-2b25-4493-a73b-0260eba89a59
        @HPV_35@ = cd560cd5-aa27-4bee-af53-34bd25085a04
        @HPV_39@ = 65488086-9214-4023-ae07-9645d02fa072
        @HPV_45@ = e25fe88d-807c-460f-9af6-5014c0b34215
        @HPV_51@ = abce5039-0895-4086-8ca3-20c9c20841ce
        @HPV_52@ = 2470fab8-d2ac-4fa9-9339-53459d337c5a
        @HPV_53@ = 4b1380c7-2a04-4b2c-89df-05458cb4217f
        @HPV_56@ = fa898d97-dd36-44e0-9fbe-f217a5560f9d
        @HPV_58@ = bd7ef4b1-c84b-4d1b-9771-5cf5aa55d7f6
        @HPV_59@ = 8d166674-9325-436d-95c6-a8321692496c
        @HPV_66@ = 523b0f10-91eb-43de-bcc3-f1594929b514
        @HPV_68@ = 3ca76719-dc99-42b7-842c-570d0dc55b8c
        @HPV_73@ = 80ed3ab9-5989-429c-9754-9a1a691ff8bf
        @HPV_82@ = 4ad7e1b2-0444-4f97-9e73-f24b7298c990
        @Other_Sample_ID_code@ = 90c2ef4d-e4f3-4ab1-80b8-856dbf1b90e2


    </macros>

    <style>
        .sectionHeader {
        background-color: #009d8e;;
        color: white;
        display: block;
        padding: 2px;
        font-weight: bold;
        }

        th.tableHeader {
        background-color: #009d8e;
        color: #FFFFFF;
        font-size: 16px;
        text-align: left;
        }

        ul {
        list-style-type: square;
        font-family: Verdana, Arial, Helvetica, sans-serif;
        font-size: 11px;
        }

        tr.spaceUnder>td {
        padding-bottom: 1em;
        }

        td {
        font-size: 15px;
        }

        #container {

        margin: auto;

        height: auto;
        }

        @media print {
        #container {
        display: block;
        }
        #printArea {
        display: none;
        }
        #userBar {
        display: none;
        }
        #banner {
        display: none;
        }
        #footer {
        display: none;
        }
        #htmlFormEntryBanner {
        display: none;
        }
        .error {
        display: none;
        }
        .lables {
        width: 200px;
        }
        table {
        width: 100%;
        }
        table,td,th {
        border: 1px solid black;
        border-collapse: collapse;
        }
        th {
        text-align: left;
        background-color: #D9D9D9;
        font-size: 10px;
        }
        td {
        font-size: 10px;
        }
        .value {
        font-size: 20px;
        font-weight: bold;
        font-style: italic;
        }
        .selectedCancerStagingKeys {
        page-break-before: always;
        border: 0px;
        }
        table.selectedCancerStagingKeys td {
        border: 0px;
        }
        #signature {
        border: none;
        }
        #signature td {
        border: none;
        }
        }

        @media screen {
        table {
        border: 1px solid #DFDFDF;
        width: 100%;
        border-color: #009d8e;
        }
        #container {
        display: block;
        }
        #printArea {
        display: none;
        }
        }
    </style>
    <script type="text/javascript">
        if(jQuery){
            $j(document).ready(function() {

            /* spacemen code auto create */
                var spacemenDate = "<lookup expression="fn.latestObs(107258).obsDatetime"/>";
                var spacemenCode = "<lookup expression="fn.latestObs(107258).valueText"/>";

                const diffTime = (new Date()) - new Date(spacemenDate);
                const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24) );

                if(diffDays &#60; 32) {
                setValue('specimenCode.value', spacemenCode);
                }
            /* End */
            /* auto populate next visit date */

            function formatDate(date,number) {
                var d = new Date(date);
                var month = '' + (d.getMonth() + 1);
                var day = '' + d.getDate();
                var year = d.getFullYear() + number;

                if (month.length &#60; 2){
                    month = '0' + month;
                }
                if (day.length &#60; 2){
                    day = '0' + day;
                }
                return [ year, month, day].join('-');
            }


            function autoPopulateNextVisitDate(){
                if($j("#testResultsNegative" ).children().prop("checked")) {

                    $j("#nextVisit").show();
                    var HIVStatus = "<lookup expression="fn.latestObs(3753).getValueCoded().name"/>";

                    if(HIVStatus == "POSITIVE"){
                        var nextVis = new Date();
                        setValue('nextVisitObs.value', formatDate(nextVis,3));

                    }
                    else if(HIVStatus == "NEGATIVE"){
                        var nextVis = new Date();
                        setValue('nextVisitObs.value', formatDate(nextVis,5));
                    }
                    else{
                        var nextVis = new Date();
                        setValue('nextVisitObs.value', formatDate(nextVis,5));
                    }
                }
                else if(!$j("#testResultsNegative" ).children().prop("checked")){
                    setValue('nextVisitObs.value', "");
                    //$j("#nextVisit").hide();
                }

            }

            $j( "#testResultsPositive" ).click(function() {
                autoPopulateNextVisitDate();
            });
            $j( "#testResultsNegative" ).click(function() {
                autoPopulateNextVisitDate();
            });
            $j( "#testResultsFailured" ).click(function() {
                autoPopulateNextVisitDate();
            });

            /* End */

            });
        }
    </script>
    <script type="text/javascript">
        if(jQuery){
         $j(document).ready(function(){
             // Tick and hide cervicalCancer obs tag
             $j("#cervicalCancer").hide();
             $j("#cervicalCancer input").attr('checked','checked');

             $j("#postoperativeChemo").hide();
             $j("#postoperativeChemo input").attr('checked','checked');


             var pathologgyClone = $j("#toggleble20").clone();


             $j("#pathologyCompletedNo").click(function(){
                 $j("#toggleble20").replaceWith(pathologgyClone);
                 pathologgyClone = $j("#toggleble20").clone();
         });

            if ( $j.browser.msie ) {
                $j(":checkbox").click(function(){
                     $j(this).change();
             });
                }

            $j(".checkboxGroup").each(function(){
                var group = $j(this);
                var checked = group.find(":checked").closest("td").attr("id");

                var uncheckAll = function(){
                    group.find("input[type$='checkbox']").attr("checked",false);
                    group.find("input[type$='checkbox']").change();
                }

                var showSection = function(which){
                    if(which !=""){
                    var triggerIndex = which.substring(7);
                    var sectionId= "toggleble"+triggerIndex;
                    $j(".togglebles").find("tbody[id$="+sectionId+"]").fadeIn(1000);
                   }
                }



                var hideSection = function(which){
                    var sectionId= "toggleble"+which.substring(7);
                    $j(".togglebles").find("tbody[id$="+sectionId+"]").hide();
                }

            group.find("input[type$='checkbox']").click(function(){
                if(typeof checked != "undefined")
                    hideSection(checked);
                uncheckAll();
                $j(this).siblings("input[type$='checkbox']").attr("checked",false);
                $j(this).attr("checked",true);
                checked = group.find(":checked").closest("td").attr("id");
                $j(this).change();
                showSection($j(this).closest("td").attr("id"));
            });

            });

         });
        }
    </script>
    <script>
        // helps in hide and show. Just add a span around the obs checkbox and give it a class(activate to the one that triggers
        //showing and deactivate to the one that triggers hiding), an id and title.
        // The class of an element to hide/show should equal the title of the tile of the checkbox that triggers hide/show.
        // to be clicked



        if(jQuery){
            $j(document).ready(function(){

                $j( ".activate" ).click(function() {

                    //var classesOfTheClicked = $j(this).prop('class');
                    var idOfTheClicked = $j(this).attr('id');
                    var titleOfTheClicked = $j(this).attr('title');

                    if($j("#"+idOfTheClicked ).children().prop("checked")){

                        $j("."+titleOfTheClicked).show();
                    }
                    else if(!$j("#"+idOfTheClicked ).children().prop("checked")){

                        $j("."+titleOfTheClicked).find("input").attr("checked",false);
                        $j("."+titleOfTheClicked).find("input").val("");
                        $j("."+titleOfTheClicked).find("select").val("");
                        $j("."+titleOfTheClicked).hide();
                    }
                });
                $j( ".deactivate" ).click(function() {

                    //var classesOfTheClicked = $j(this).prop('class');
                    var idOfTheClicked = $j(this).attr('id');
                    var titleOfTheClicked = $j(this).attr('title');

                    if($j("#"+idOfTheClicked ).children().prop("checked")){

                        $j("."+titleOfTheClicked).find("input").attr("checked",false);
                        $j("."+titleOfTheClicked).find("input").val("");
                        $j("."+titleOfTheClicked).find("select").val("");
                        $j("."+titleOfTheClicked).hide();

                    }
                    else if(!$j("#"+idOfTheClicked ).children().prop("checked")){

                        $j("."+titleOfTheClicked).show();
                    }

                });
                $j(".initialHide").hide();

            });
        }
    </script>


    <postSubmissionAction class="org.openmrs.module.rbcmessaging.util.SendHPVResultMessageOnHtmlFormSubmissionAction"/>

    <section>
        <table border="1" cellspacing="0" cellpadding="6" width="100%">
            <tr>
                <td>
                    <b>
                        IMB ID: <lookup class="value"
                                        expression="patientIdentifiers.get(&quot;IMB ID&quot;)" />
                        <br/>
                        <!--                        IMB Primary Care Registration ID:-->
                        <!--                        <lookup-->
                        <!--                                class="value"-->
                        <!--                                expression="patientIdentifiers.get(&quot;IMB Primary Care Registration ID&quot;)" />-->
                        <!--                        <br/>-->
                        <!--                        OpenClinic ID:-->
                        <!--                        <lookup class="value"-->
                        <!--                                expression="patientIdentifiers.get(&quot;OpenClinic ID&quot;)" />-->
                        <!--                        <br/>-->
                        <!--                        ARCHIVING ID:-->
                        <!--                        <lookup class="value"-->
                        <!--                                expression="patientIdentifiers.get(&quot;ARCHIVING ID&quot;)" />-->
                        <!--                        <br/>-->
                        Rwanda National ID:
                        <lookup class="value"
                                expression="patientIdentifiers.get(&quot;Rwanda National ID&quot;)" />
                    </b>

                </td>
                <td>Date: <encounterDate id="encounterDate" default="today" />
                </td>
            </tr>
            <tr>
                <td>Nom / Last name: <lookup class="value"
                                             expression="patient.personName.familyName" />
                </td>
                <td>Pr√©nom/ First name: <lookup class="value"
                                                expression="patient.personName.givenName" />
                </td>
            </tr>
            <tr>
                <td> Gender: <lookup class="value" expression="patient.gender"/> </td>
                <td> Date Of Birth: <lookup class="value" expression="patient.birthdate"/> </td>
            </tr>
            <tr>
                <td><img src="/openmrs/moduleResources/rwandareports/images/rwanda-logo.jpg" align="left"
                         height="65" ></img>
                    <b>REPUBLIC OF RWANDA
                        <br />MINISTRY OF HEALTH</b>
                </td>
                <td ><strong>
                    Oncology Screening Lab Results
                </strong> </td>
            </tr>
            <tr>
                <td>Location Name: <encounterLocation
                        id="encounterLocation" />
                </td>
                <td>Provider:<encounterProvider id="encounterProvider"
                                                role="Provider" default="currentUser"/>
                </td>

            </tr>
        </table>
    </section>
    <section >
        <table class="form-group" border="1">
            <tr>
                <td>

                    Specimen code
                </td>
                <td>
                    <!--                        <input id="obs.specimenCode" name="obs.specimenCode" type="text"-->
                    <!--                               data-concept="16cd65e3-45af-4291-88fd-fe4d91847e4f^Specimen Code^99DCT">-->
                    <obs id="specimenCode" conceptId="$@Specimen_Code@" required="true"/>
                    (Fosaid/year(e.g 23 0r 24)/patient number in register)

                    <br/>
                    <br/>
                </td>
            </tr>
            <tr>
                <td>Other sample code</td>
                <td>
                    <obs id="specimenCode" conceptId="$@Other_Sample_ID_code@" />

<!--                    <label>-->
<!--                        Other sample code-->
<!--                    </label>-->
<!--                    <br/>-->
<!--                    <label class="font-normal">-->
<!--                        <input id="obs.OtherSampleIDCode" name="obs.OtherSampleIDCode" type="text"-->
<!--                               data-concept="90c2ef4d-e4f3-4ab1-80b8-856dbf1b90e2^Other Sample ID code^99DCT">-->
<!--                    </label>-->

                </td>
            </tr>
            <tr>
                <td>
                    Lab Test:
                </td>
                <td>

                    <obs conceptId="$@Screening_through@" answerConceptIds="$@HPV_DNA_test@,$@OTHER_NON-CODED@" answerLabels="HPV,Other" style="radio"/>
                </td>
            </tr>
            <tr>
                <td rowspan="2">
                    Results
                </td>
                <td class="checkboxGroup">
                    <span class="activate" id="testResultsPositive" title="testResults">
                        <obs conceptId="$@Test_Result@" answerConceptId="$@HPV_positive@" answerLabel="HPV Positive" style="radio"/>
                    </span>
                    <span class="deactivate" id="testResultsNegative" title="testResults">
                        <obs conceptId="$@Test_Result@" answerConceptId="$@HPV_negative@" answerLabel="HPV Negative" style="checkbox"/>
                    </span>
                    <span class="deactivate" id="testResultsFailured" title="testResults">
                        <obs conceptId="$@Test_Result@" answerConceptId="$@Failed_results@" answerLabel="Failed results. Take sample again" style="checkbox"/>
                    </span>

                    <!--                    <obs conceptId="$@Test_Result@" answerConceptId="$@HPV_negative@" answerLabel="HPV Negative" style="checkbox"/>-->

                </td>
            </tr>
            <tr>
                <td>
                    <span class="testResults">
                        If positive,specify
                        <obs conceptId="$@HPV_positive_Type@" answerConceptId="$@HPV_16@" answerLabel="HPV 16" style="checkbox"/>
                        <obs conceptId="$@HPV_positive_Type@" answerConceptId="$@HPV_18@" answerLabel="HPV 18" style="checkbox"/>
                        <obs conceptId="$@HPV_positive_Type@" answerConceptId="$@HPV_31@" answerLabel="HPV 31" style="checkbox"/>
                        <obs conceptId="$@HPV_positive_Type@" answerConceptId="$@HPV_33@" answerLabel="HPV 33" style="checkbox"/>
                        <obs conceptId="$@HPV_positive_Type@" answerConceptId="$@HPV_35@" answerLabel="HPV 35" style="checkbox"/>
                        <obs conceptId="$@HPV_positive_Type@" answerConceptId="$@HPV_39@" answerLabel="HPV 39" style="checkbox"/>
                        <obs conceptId="$@HPV_positive_Type@" answerConceptId="$@HPV_45@" answerLabel="HPV 45" style="checkbox"/>
                        <obs conceptId="$@HPV_positive_Type@" answerConceptId="$@HPV_51@" answerLabel="HPV 51" style="checkbox"/>
                        <obs conceptId="$@HPV_positive_Type@" answerConceptId="$@HPV_52@" answerLabel="HPV 52" style="checkbox"/>
                        <obs conceptId="$@HPV_positive_Type@" answerConceptId="$@HPV_53@" answerLabel="HPV 53" style="checkbox"/>
                        <obs conceptId="$@HPV_positive_Type@" answerConceptId="$@HPV_56@" answerLabel="HPV 56" style="checkbox"/>
                        <obs conceptId="$@HPV_positive_Type@" answerConceptId="$@HPV_58@" answerLabel="HPV 58" style="checkbox"/>
                        <obs conceptId="$@HPV_positive_Type@" answerConceptId="$@HPV_59@" answerLabel="HPV 59" style="checkbox"/>
                        <obs conceptId="$@HPV_positive_Type@" answerConceptId="$@HPV_66@" answerLabel="HPV 66" style="checkbox"/>
                        <obs conceptId="$@HPV_positive_Type@" answerConceptId="$@HPV_68@" answerLabel="HPV 68" style="checkbox"/>
                        <obs conceptId="$@HPV_positive_Type@" answerConceptId="$@HPV_73@" answerLabel="HPV 73" style="checkbox"/>
                        <obs conceptId="$@HPV_positive_Type@" answerConceptId="$@HPV_82@" answerLabel="HPV 82" style="checkbox"/>
                        <obs conceptId="$@HPV_positive_Type@" answerConceptId="$@Other_HR_HPV@" answerLabel="Other HR HPV" style="checkbox"/>

                    </span>
                </td>
            </tr>
            <tr>
                <td>Other test</td>
                <td>
                    <obs conceptId="$@LABORATORY_TESTS_OTHER@"/>
                </td>
            </tr>
            <tr>
                <td>Result</td>
                <td>
                    <obs conceptId="$@OTHER_LAB_TEST_RESULT@"/>
                </td>
            </tr>
            <tr id="nextVisit">
                <td class="font-normal"> <strong> Date of next visit:  </strong> </td>
                <td class="font-normal">
                    <!--                    <input id="obs.BreastDispositionNextDate" name="obs.BreastDispositionNextDate" type="date"-->
                    <!--                           data-concept="3ce94df0-26fe-102b-80cb-0017a47871b2^RETURN VISIT DATE^99DCT"/>-->
                    <obs id="nextVisitObs" conceptId="$@RETURN_VISIT_DATE@" allowFutureDates="true" readonly="readonly"/>
                </td>

            </tr>
        </table>

    </section>
    <br />
    <br />
    <submit />
    <br/>
    <br/>
    <br/>
    <br/>
    <encounterVoided/>
</htmlform>